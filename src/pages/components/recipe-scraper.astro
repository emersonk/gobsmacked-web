---
// src/pages/recipe-scraper.astro
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Recipe Scraper</title>
    <style>
      .container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 0 1rem;
      }
      .form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-bottom: 2rem;
      }
      .input {
        padding: 0.75rem;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      .button {
        padding: 0.75rem 1rem;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }
      .recipe-display {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
      }
      .recipe-section {
        padding: 1rem;
        border-radius: 8px;
        background-color: #f5f5f5;
      }
      .loading {
        text-align: center;
        padding: 2rem;
      }
      .error {
        color: #dc3545;
        padding: 1rem;
        border-radius: 4px;
        background-color: #f8d7da;
      }
      .recipe-image {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Recipe Scraper</h1>
      <form class="form" id="recipeForm">
        <input
          type="url"
          id="recipeUrl"
          class="input"
          placeholder="Enter recipe URL"
          required
        />
        <button type="submit" class="button" id="submitButton"
          >Scrape Recipe</button
        >
      </form>
      <div id="loading" class="loading" style="display: none;">
        Processing recipe...
      </div>
      <div id="error" class="error" style="display: none;"></div>
      <div id="recipeResult" class="recipe-display" style="display: none;">
        <div class="recipe-section">
          <h2>Recipe Details</h2>
          <img
            id="recipeImage"
            class="recipe-image"
            alt="Recipe"
            style="display: none;"
          />
          <p><strong>Title:</strong> <span id="recipeTitle"></span></p>
          <p><strong>Total Time:</strong> <span id="recipeTime"></span></p>
          <p><strong>Yields:</strong> <span id="recipeYield"></span></p>
        </div>

        <div class="recipe-section">
          <h2>Ingredients</h2>
          <div id="ingredients"></div>
        </div>

        <div class="recipe-section">
          <h2>Instructions</h2>
          <div id="steps"></div>
        </div>
      </div>
    </div>

    <script>
      import { fetchRecipe } from "../../scripts/api";
      import {
        processRecipeData,
        formatIngredients,
        formatSteps,
      } from "../../scripts/recipeProcessing";
      import { toggleUIElements } from "../../scripts/uiHelpers";

      const form = document.getElementById("recipeForm");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const url = document.getElementById("recipeUrl").value;
        toggleUIElements.showLoading();

        try {
          const data = await fetchRecipe(url);
          const processed = processRecipeData(data);

          console.log(data);
          console.log(processed);

          // Update recipe details
          document.getElementById("recipeTitle").textContent =
            data.original_recipe.title;
          document.getElementById("recipeTime").textContent =
            `${data.original_recipe.total_time} minutes`;
          document.getElementById("recipeYield").textContent =
            data.original_recipe.yields;

          // Handle image
          const recipeImage = document.getElementById("recipeImage");
          if (data.original_recipe.image) {
            recipeImage.src = data.original_recipe.image;
            recipeImage.style.display = "block";
          }

          // Update ingredients and steps
          document.getElementById("ingredients").innerHTML = formatIngredients(
            processed.ingredients.ingredients
          );
          document.getElementById("steps").innerHTML = formatSteps(
            processed.steps.steps
          );

          toggleUIElements.showResult();
        } catch (error) {
          toggleUIElements.showError(error.message);
        } finally {
          toggleUIElements.hideLoading();
        }
      });
    </script>
  </body>
</html>
