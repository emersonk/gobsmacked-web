---
// src/pages/recipe-scraper.astro
import BaseLayout from "@/layouts/BaseLayout.astro";
import { databases } from "@/lib/appwrite";

interface RecipeData {
    url: string;
}

// Template vars
let recipeData: RecipeData | null = null;
let error: string | null = null;

// Server-side form handling
if (Astro.request.method === 'POST') {
    try {
        const formData = await Astro.request.formData();
        const recipeUrl = formData.get('recipeUrl');
        
        if (typeof recipeUrl !== 'string') {
            throw new Error('Recipe URL must be a string');
        }

        recipeData = {
            url: recipeUrl
        };

        console.log(recipeUrl);
        return Astro.redirect('/components/recipe-scraper');
    } catch (err) {
        error = `Failed to process recipe: ${err instanceof Error ? err.message : 'Unknown error'}`;
    }
}
---

<BaseLayout>
    <div class="container">
        <h1>Recipe Scraper</h1>
        
        <form method="POST" class="form">
            <input
                type="url"
                name="recipeUrl"
                class="input"
                placeholder="Enter recipe URL"
                required
            />
            <button type="submit" class="button">Scrape Recipe</button>
        </form>

        {error && <div class="error">{error}</div>}

        {recipeData && (
            <div class="recipe-display">
                <div class="recipe-section">
                    <h2>Recipe Details</h2>
                    <p>URL submitted: {recipeData.url}</p>
                </div>
            </div>
        )}
    </div>
</BaseLayout>